window.dojo&&dojo.provide("doh._browserRunner"),function(){doh.setTimeout=function(e,t){return setTimeout(e,t)};try{var topdog=window.parent==window||!Boolean(window.parent.doh)}catch(e){topdog=!0}if(topdog){var byId=function(e){return document.getElementById(e)},_addOnEvt=function(e,t,o){o||(o=window);var r=t;"string"==typeof t&&(r=o[t]);var d=function(){return r.apply(o,arguments)};window.dojo&&"load"==e?dojo.addOnLoad(d):window.attachEvent?window.attachEvent("on"+e,d):window.addEventListener?window.addEventListener(e,d,!1):document.addEventListener&&document.addEventListener(e,d,!1)},escapeXml=function(e){return e.replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/gm,"&quot;")},_logBacklog=[],_loggedMsgLen=0,sendToLogPane=function(e,t){for(var o="",r=0;r<e.length;r++)o+=" "+e[r];if(o=escapeXml(o),o=o.replace("\t","&nbsp;&nbsp;&nbsp;&nbsp;").replace(" ","&nbsp;").replace("\n","<br>&nbsp;"),!byId("logBody"))return void _logBacklog.push(o);if(_logBacklog.length&&!t)for(var d;d=_logBacklog.shift();)sendToLogPane(d,!0);var n=byId("logBody"),i=document.createElement("div");i.innerHTML=o,n.appendChild(i),_loggedMsgLen++},findTarget=function(e){for(;e&&!e.getAttribute("_target");)e=e.parentNode,e.getAttribute||(e=null);return e};doh._jumpToLog=function(e){var t=findTarget(e?e.target:window.event.srcElement);if(t){var o=Number(t.getAttribute("_target")),r=byId("logBody");if(!(o>=r.childNodes.length)){var d=r.childNodes[o];if(d.scrollIntoView(),window.dojo){var n=dojo.style(d.parentNode.parentNode,"backgroundColor"),i=dojo.style(t.parentNode,"backgroundColor"),a=dojo.animateProperty({node:d,duration:500,properties:{backgroundColor:{start:i,end:n}},onEnd:function(){d.style.backgroundColor=""}}),s=dojo.animateProperty({node:d,duration:500,properties:{backgroundColor:{start:n,end:i}},onEnd:function(){a.play()}});s.play()}}}},doh._jumpToSuite=function(e){var t=findTarget(e?e.target:window.event.srcElement);if(t){var o=t.getAttribute("_target"),r=getGroupNode(o);r&&r.scrollIntoView()}},doh._init=function(e){return function(){var t=byId("logBody");if(t){for(;t.firstChild;)t.removeChild(t.firstChild);_loggedMsgLen=0}this._totalTime=0,this._suiteCount=0,e.apply(doh,arguments)}}(doh._init),doh._setupGroupForRun=function(e){return function(t){var o=doh._groups[t];doh._curTestCount=o.length,doh._curGroupCount=1;var r=getGroupNode(t);r&&r.getElementsByTagName("td")[2].setAttribute("_target",_loggedMsgLen+1),e.apply(doh,arguments)}}(doh._setupGroupForRun),doh._report=function(e){return function(){var t=byId("testList");if(t){var o=t.getElementsByTagName("tfoot");o.length&&t.removeChild(o[0]);var r=t.createTFoot(),d=r.insertRow(-1);d.className="inProgress";var n=d.insertCell(-1);n.colSpan=2,n.innerHTML="Result",n=d.insertCell(-1),n.innerHTML=this._testCount+" tests in "+this._groupCount+" groups /<span class='failure'>"+this._errorCount+"</span> errors, <span class='failure'>"+this._failureCount+"</span> failures",n.setAttribute("_target",_loggedMsgLen+1),d.insertCell(-1).innerHTML=doh._totalTime+"ms"}var i=null;if(doh.perfTestResults){window.dojo?(dojo.require("dojox.charting.Chart2D"),dojo.require("dojox.charting.DataChart"),dojo.require("dojox.charting.plot2d.Scatter"),dojo.require("dojox.charting.plot2d.Lines"),dojo.require("dojo.data.ItemFileReadStore"),i=doh._dojoPlotPerfResults):i=doh._asciiPlotPerfResults;try{var a,s=byId("perfTestsBody"),u=[];doh.perfTestResults&&doh.showPerfTestsPage();for(a in doh.perfTestResults){var l=doh.perfTestResults[a],h=document.createElement("h1");h.appendChild(document.createTextNode("Group: "+a)),s.appendChild(h);var p=document.createElement("blockquote");s.appendChild(p);var g;for(g in l){var c=l[g];if(c){var m=document.createElement("h3");m.appendChild(document.createTextNode("TEST: "+g)),m.style.textDecoration="underline",p.appendChild(m);var T=document.createElement("div");p.appendChild(T);var _,f="<b>TRIAL SIZE: </b>"+c.trials[0].testIterations+" iterations<br><b>NUMBER OF TRIALS: </b>"+c.trials.length+"<br>",y=[],b=[];for(_=0;_<c.trials.length;_++)y.push(c.trials[_].average),b.push(c.trials[_].executionTime);f+="<b>AVERAGE TRIAL EXECUTION TIME: </b>"+doh.average(b).toFixed(10)+"ms.<br>",f+="<b>MAXIMUM TEST ITERATION TIME: </b>"+doh.max(y).toFixed(10)+"ms.<br>",f+="<b>MINIMUM TEST ITERATION TIME: </b>"+doh.min(y).toFixed(10)+"ms.<br>",f+="<b>AVERAGE TEST ITERATION TIME: </b>"+doh.average(y).toFixed(10)+"ms.<br>",f+="<b>MEDIAN TEST ITERATION TIME: </b>"+doh.median(y).toFixed(10)+"ms.<br>",f+="<b>VARIANCE TEST ITERATION TIME: </b>"+doh.variance(y).toFixed(10)+"ms.<br>",f+="<b>STANDARD DEVIATION ON TEST ITERATION TIME: </b>"+doh.standardDeviation(y).toFixed(10)+"ms.<br>",T.innerHTML=f,T=document.createElement("div"),T.innerHTML="<h3>Average Test Execution Time (in milliseconds, with median line)</h3>",p.appendChild(T),T=document.createElement("div"),dojo.style(T,"width","600px"),dojo.style(T,"height","250px"),p.appendChild(T),u.push({div:T,title:"Average Test Execution Time",data:y}),T=document.createElement("div"),T.innerHTML="<h3>Average Trial Execution Time (in milliseconds, with median line)</h3>",p.appendChild(T),T=document.createElement("div"),dojo.style(T,"width","600px"),dojo.style(T,"height","250px"),p.appendChild(T),u.push({div:T,title:"Average Trial Execution Time",data:b})}}}var v=function(){if(u.length){var e=u.shift();i(e.div,e.title,e.data)}doh.setTimeout(v,50)};doh.setTimeout(v,150)}catch(N){doh.debug(N)}}e.apply(doh,arguments)}}(doh._report),this.opera&&opera.postError?doh.debug=function(){for(var e="",t=0;t<arguments.length;t++)e+=" "+arguments[t];sendToLogPane([e]),opera.postError("DEBUG:"+e)}:window.console?doh.debug=function(){for(var e="",t=0;t<arguments.length;t++)e+=" "+arguments[t];sendToLogPane([e]),console.log("DEBUG:"+e)}:doh.debug=function(){sendToLogPane.call(window,arguments)};var loaded=!1,groupTemplate=null,testTemplate=null,groupNodes={},_groupTogglers={},_getGroupToggler=function(e,t){if(_groupTogglers[e])return _groupTogglers[e];var o=!0;return _groupTogglers[e]=function(r,d){var n,i=groupNodes[e].__items;if(o||d){for(o=!1,n=0;n<i.length;n++)i[n].style.display="";t.innerHTML="&#9660;"}else{for(o=!0,n=0;n<i.length;n++)i[n].style.display="none";t.innerHTML="&#9658;"}}},addGroupToList=function(e){if(byId("testList")){var t=byId("testList").tBodies[0],o=groupTemplate.cloneNode(!0),r=o.getElementsByTagName("td"),d=r[0];d.onclick=_getGroupToggler(e,d);var n=r[1].getElementsByTagName("input")[0];return n.group=e,n.onclick=function(t){doh._groups[e].skip=!this.checked},r[2].innerHTML="<div class='testGroupName'>"+e+"</div><div style='width:0;'>&nbsp;</div>",r[3].innerHTML="",t.appendChild(o),o}},addFixtureToList=function(e,t){if(testTemplate){var o=groupNodes[e];o.__items||(o.__items=[]);var r=testTemplate.cloneNode(!0),d=r.getElementsByTagName("td");d[2].innerHTML=t.name,d[3].innerHTML="";var n=(o.__lastFixture||o.__groupNode).nextSibling;return n?n.parentNode.insertBefore(r,n):o.__groupNode.parentNode.appendChild(r),r.style.display="none",o.__items.push(r),o.__lastFixture=r}},getFixtureNode=function(e,t){return groupNodes[e]?groupNodes[e][t.name]:null},getGroupNode=function(e){return groupNodes[e]?groupNodes[e].__groupNode:null},updateBacklog=[];doh._updateTestList=function(e,t,o){if(!loaded)return void(e&&t&&updateBacklog.push([e,t]));if(updateBacklog.length&&!o)for(var r;r=updateBacklog.shift();)doh._updateTestList(r[0],r[1],!0);e&&t&&(groupNodes[e]||(groupNodes[e]={__groupNode:addGroupToList(e)}),groupNodes[e][t.name]||(groupNodes[e][t.name]=addFixtureToList(e,t)))},doh._testRegistered=doh._updateTestList,doh._groupStarted=function(e){0==this._suiteCount&&(this._runedSuite=0,this._currentGlobalProgressBarWidth=0,this._suiteCount=this._testCount),doh._inGroup!=e&&(doh._groupTotalTime=0,doh._runed=0,doh._inGroup=e,this._runedSuite++);var t=getGroupNode(e);t&&(t.className="inProgress")},doh._groupFinished=function(e,t){var o=getGroupNode(e);if(o&&doh._inGroup==e){doh._totalTime+=doh._groupTotalTime,o.getElementsByTagName("td")[3].innerHTML=doh._groupTotalTime+"ms",o.getElementsByTagName("td")[2].lastChild.className="",doh._inGroup=null;var r=doh._updateGlobalProgressBar(this._runedSuite/this._groupCount,t,e);o.className=r?"failure":"success",doh._currentGlobalProgressBarWidth=parseInt(this._runedSuite/this._groupCount*1e4)/100}doh._inGroup==e&&this.debug('Total time for GROUP "',e,'" is ',doh._groupTotalTime,"ms")},doh._testStarted=function(e,t){var o=getFixtureNode(e,t);o&&(o.className="inProgress")};var _nameTimes={},_playSound=function(e){if(byId("hiddenAudio")&&byId("audio")&&byId("audio").checked){var t=_nameTimes[e];if(!t||new Date-t>700){_nameTimes[e]=new Date;var o=document.createElement("span");byId("hiddenAudio").appendChild(o),o.innerHTML='<embed src="_sounds/'+e+'.wav" autostart="true" loop="false" hidden="true" width="1" height="1"></embed>'}}};doh._updateGlobalProgressBar=function(e,t,o){var r=byId("progressOuter"),d=r.childNodes[doh._runedSuite-1];d||(d=document.createElement("div"),r.appendChild(d),d.className="success",d.setAttribute("_target",o)),t||d._failure||(d._failure=!0,d.className="failure",o&&d.setAttribute("title","failed group "+o));var n=parseInt(1e4*e)/100;return d.style.width=n-doh._currentGlobalProgressBarWidth+"%",d._failure},doh._testFinished=function(e,t,o){var r=getFixtureNode(e,t),d=t.endTime-t.startTime;if(r&&(r.getElementsByTagName("td")[3].innerHTML=d+"ms",r.className=o?"success":"failure",r.getElementsByTagName("td")[2].setAttribute("_target",_loggedMsgLen),!o)){_playSound("doh");var n=getGroupNode(e);n&&(n.className="failure",_getGroupToggler(e)(null,!0))}if(doh._inGroup==e){var n=getGroupNode(e);if(doh._runed++,n&&doh._curTestCount){var i=doh._runed/doh._curTestCount,a=this._updateGlobalProgressBar((doh._runedSuite+i-1)/doh._groupCount,o,e),s=n.getElementsByTagName("td")[2].lastChild;s.className=a?"failure":"success",s.style.width=parseInt(100*i)+"%",n.getElementsByTagName("td")[3].innerHTML=parseInt(1e4*i)/100+"%"}}this._groupTotalTime+=d,this.debug(o?"PASSED":"FAILED","test:",t.name,d,"ms")},doh.registerUrl=function(e,t,o){var r=new String(e);this.register(e,{name:t,setUp:function(){doh.currentGroupName=r,doh.currentGroup=this,doh.currentUrl=t,this.d=new doh.Deferred,doh.currentTestDeferred=this.d,doh.showTestPage(),byId("testBody").src=t},timeout:o||1e4,runTest:function(){return this.d},tearDown:function(){doh.currentGroupName=null,doh.currentGroup=null,doh.currentTestDeferred=null,doh.currentUrl=null,doh.showLogPage()}})};var tabzidx=1,_showTab=function(toShow,toHide){var i;for(i=0;i<toHide.length;i++){var node=byId(toHide[i]);node&&(node.style.display="none")}if(toShow=byId(toShow))with(toShow.style)display="",zIndex=++tabzidx};doh.showTestPage=function(){_showTab("testBody",["logBody","perfTestsBody"])},doh.showLogPage=function(){_showTab("logBody",["testBody","perfTestsBody"])},doh.showPerfTestsPage=function(){_showTab("perfTestsBody",["testBody","logBody"])};var runAll=!0;doh.toggleRunAll=function(){if(runAll=!runAll,byId("testList"))for(var e,t=byId("testList").tBodies[0],o=t.getElementsByTagName("input"),r=0;e=o[r++];)e.checked=runAll,doh._groups[e.group].skip=!runAll};var listHeightTimer=null,setListHeight=function(){listHeightTimer&&clearTimeout(listHeightTimer);var e=byId("testList");e&&(listHeightTimer=doh.setTimeout(function(){e.style.display="none",e.style.display=""},10))};_addOnEvt("resize",setListHeight),_addOnEvt("load",setListHeight),_addOnEvt("load",function(){loaded||(loaded=!0,groupTemplate=byId("groupTemplate"),groupTemplate&&(groupTemplate.parentNode.removeChild(groupTemplate),groupTemplate.style.display="",testTemplate=byId("testTemplate"),testTemplate.parentNode.removeChild(testTemplate),testTemplate.style.display="",doh._updateTestList()))}),_addOnEvt("load",function(){var e=doh._onEnd;if(doh._onEnd=function(){e.apply(doh,arguments),0==doh._failureCount?(doh.debug("WOOHOO!!"),_playSound("woohoo")):console.debug("doh._failureCount:",doh._failureCount),byId("play")&&o()},byId("play")){var t=!1,o=function(){t?(byId("play").style.display=byId("pausedMsg").style.display="",byId("playingMsg").style.display=byId("pause").style.display="none",t=!1):(byId("play").style.display=byId("pausedMsg").style.display="none",byId("playingMsg").style.display=byId("pause").style.display="",t=!0)};doh.run=function(e){return function(){return doh._currentGroup||o(),e.apply(doh,arguments)}}(doh.run);for(var r,d=byId("toggleButtons").getElementsByTagName("span"),n=0;r=d[n++];)r.onclick=o;doh._dojoPlotPerfResults=function(e,t,o){var r,d=doh.median(o),n=[];for(r=0;r<o.length;r++)n.push(d);var i={label:"name",items:[{name:t,trials:o},{name:"Median",trials:n}]},a=new dojo.data.ItemFileReadStore({data:i}),s=Math.floor(doh.min(o)),u=Math.ceil(doh.max(o)),l=(u-s)/10;s>0&&(s-=l,s<0&&(s=0),s=Math.floor(s)),u>0&&(u+=l,u=Math.ceil(u)),l=(u-s)/10;var h=new dojox.charting.DataChart(e,{type:dojox.charting.plot2d.Lines,displayRange:o.length,xaxis:{min:1,max:o.length,majorTickStep:Math.ceil((o.length-1)/10),htmlLabels:!1},yaxis:{min:s,max:u,majorTickStep:l,vertical:!0,htmlLabels:!1}});h.setStore(a,{name:"*"},"trials")},doh._asciiPlotPerfResults=function(){}}})}else{_doh=window.parent.doh;var _thisGroup=_doh.currentGroupName,_thisUrl=_doh.currentUrl;if(_thisGroup){doh._testRegistered=function(e,t){_doh._updateTestList(_thisGroup,t)},doh._onEnd=function(){_doh._errorCount+=doh._errorCount,_doh._failureCount+=doh._failureCount,_doh._testCount+=doh._testCount,_doh.currentTestDeferred.callback(!0)};var otr=doh._getTestObj;doh._getTestObj=function(){var e=otr.apply(doh,arguments);return e.name=_thisUrl+"::"+arguments[0]+"::"+e.name,e},doh.debug=doh.hitch(_doh,"debug"),doh.registerUrl=doh.hitch(_doh,"registerUrl"),doh._testStarted=function(e,t){_doh._testStarted(_thisGroup,t)},doh._testFinished=function(e,t,o){if(_doh._testFinished(_thisGroup,t,o),doh.perfTestResults)try{gName=e.toString();for(var r=t.name;r.indexOf("::")>=0;)r=r.substring(r.indexOf("::")+2,r.length);_doh.perfTestResults||(_doh.perfTestResults={}),_doh.perfTestResults[gName]||(_doh.perfTestResults[gName]={}),_doh.perfTestResults[gName][t.name]=doh.perfTestResults[gName][r]}catch(d){doh.debug(d)}},doh._groupStarted=function(e){this._setParent||(_doh._curTestCount=this._testCount,_doh._curGroupCount=this._groupCount,this._setParent=!0)},doh._report=function(){}}}}();