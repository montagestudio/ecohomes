this.doh||(doh={}),doh.selfTest=!1,doh.global=this,doh.hitch=function(t,e){for(var r=[],n=2;n<arguments.length;n++)r.push(arguments[n]);var i=("string"==typeof e?t[e]:e)||function(){};return function(){for(var e=r.concat([]),n=0;n<arguments.length;n++)e.push(arguments[n]);return i.apply(t,e)}},doh._mixin=function(t,e){var r={};for(var n in e)void 0!==r[n]&&r[n]==e[n]||(t[n]=e[n]);return this.document&&document.all&&"function"==typeof e.toString&&e.toString!=t.toString&&e.toString!=r.toString&&(t.toString=e.toString),t},doh.mixin=function(t,e){for(var r=1,n=arguments.length;r<n;r++)doh._mixin(t,arguments[r]);return t},doh.extend=function(t,e){for(var r=1,n=arguments.length;r<n;r++)doh._mixin(t.prototype,arguments[r]);return t},doh._line="------------------------------------------------------------",doh.debug=function(){},doh._AssertFailure=function(t,e){return this instanceof doh._AssertFailure?(e&&(t=new String(t||"")+" with hint: \n\t\t"+(new String(e)+"\n")),this.message=new String(t||""),this):new doh._AssertFailure(t,e)},doh._AssertFailure.prototype=new Error,doh._AssertFailure.prototype.constructor=doh._AssertFailure,doh._AssertFailure.prototype.name="doh._AssertFailure",doh.Deferred=function(t){this.chain=[],this.id=this._nextId(),this.fired=-1,this.paused=0,this.results=[null,null],this.canceller=t,this.silentlyCancelled=!1},doh.extend(doh.Deferred,{getTestErrback:function(t,e){var r=this;return function(){try{t.apply(e||doh.global||r,arguments)}catch(n){r.errback(n)}}},getTestCallback:function(t,e){var r=this;return function(){try{t.apply(e||doh.global||r,arguments)}catch(n){return void r.errback(n)}r.callback(!0)}},getFunctionFromArgs:function(){var t=arguments;if(t[0]&&!t[1]){if("function"==typeof t[0])return t[0];if("string"==typeof t[0])return doh.global[t[0]]}else if(t[0]&&t[1])return doh.hitch(t[0],t[1]);return null},makeCalled:function(){var t=new doh.Deferred;return t.callback(),t},_nextId:function(){var t=1;return function(){return t++}}(),cancel:function(){this.fired==-1?(this.canceller?this.canceller(this):this.silentlyCancelled=!0,this.fired==-1&&this.errback(new Error("Deferred(unfired)"))):0==this.fired&&this.results[0]instanceof doh.Deferred&&this.results[0].cancel()},_pause:function(){this.paused++},_unpause:function(){this.paused--,0==this.paused&&this.fired>=0&&this._fire()},_continue:function(t){this._resback(t),this._unpause()},_resback:function(t){this.fired=t instanceof Error?1:0,this.results[this.fired]=t,this._fire()},_check:function(){if(this.fired!=-1){if(!this.silentlyCancelled)throw new Error("already called!");return void(this.silentlyCancelled=!1)}},callback:function(t){this._check(),this._resback(t)},errback:function(t){this._check(),t instanceof Error||(t=new Error(t)),this._resback(t)},addBoth:function(t,e){var r=this.getFunctionFromArgs(t,e);return arguments.length>2&&(r=doh.hitch(null,r,arguments,2)),this.addCallbacks(r,r)},addCallback:function(t,e){var r=this.getFunctionFromArgs(t,e);return arguments.length>2&&(r=doh.hitch(null,r,arguments,2)),this.addCallbacks(r,null)},addErrback:function(t,e){var r=this.getFunctionFromArgs(t,e);return arguments.length>2&&(r=doh.hitch(null,r,arguments,2)),this.addCallbacks(null,r)},addCallbacks:function(t,e){return this.chain.push([t,e]),this.fired>=0&&this._fire(),this},_fire:function(){for(var t=this.chain,e=this.fired,r=this.results[e],n=this,i=null;t.length>0&&0==this.paused;){var o=t.shift(),s=o[e];if(null!=s)try{r=s(r),e=r instanceof Error?1:0,r instanceof doh.Deferred&&(i=function(t){n._continue(t)},this._pause())}catch(u){e=1,r=u}}this.fired=e,this.results[e]=r,i&&this.paused&&r.addBoth(i)}}),doh._testCount=0,doh._groupCount=0,doh._errorCount=0,doh._failureCount=0,doh._currentGroup=null,doh._currentTest=null,doh._paused=!0,doh._init=function(){this._currentGroup=null,this._currentTest=null,this._errorCount=0,this._failureCount=0,this.debug(this._testCount,"tests to run in",this._groupCount,"groups")},doh._groups={},doh.registerTestNs=function(t,e){for(var r in e)"_"!=r.charAt(0)&&"function"==typeof e[r]&&this.registerTest(t,e[r])},doh._testRegistered=function(t,e){},doh._groupStarted=function(t){},doh._groupFinished=function(t,e){},doh._testStarted=function(t,e){},doh._testFinished=function(t,e,r){},doh.registerGroup=function(t,e,r,n,i){e&&this.register(t,e,i),r&&(this._groups[t].setUp=r),n&&(this._groups[t].tearDown=n)},doh._getTestObj=function(t,e,r){var n=e;if("string"==typeof e){if("url:"==e.substr(0,4))return this.registerUrl(t,e);n={name:e.replace("/s/g","_")},n.runTest=new Function("t",e)}else if("function"==typeof e)if(n={runTest:e},e.name)n.name=e.name;else try{var i="function ",o=n.runTest+"";0<=o.indexOf(i)&&(n.name=o.split(i)[1].split("(",1)[0])}catch(s){}return"perf"!==r&&"perf"!==n.testType||(n.testType="perf",doh.perfTestResults||(doh.perfTestResults={},doh.perfTestResults[t]={}),doh.perfTestResults[t]||(doh.perfTestResults[t]={}),doh.perfTestResults[t][n.name]||(doh.perfTestResults[t][n.name]={}),n.results=doh.perfTestResults[t][n.name],"trialDuration"in n||(n.trialDuration=100),"trialDelay"in n||(n.trialDelay=100),"trialIterations"in n||(n.trialIterations=10)),n},doh.registerTest=function(t,e,r){this._groups[t]||(this._groupCount++,this._groups[t]=[],this._groups[t].inFlight=0);var n=this._getTestObj(t,e,r);return n?(this._groups[t].push(n),this._testCount++,this._testRegistered(t,n),n):null},doh.registerTests=function(t,e,r){for(var n=0;n<e.length;n++)this.registerTest(t,e[n],r)},doh.registerUrl=function(t,e,r,n){this.debug("ERROR:"),this.debug("\tNO registerUrl() METHOD AVAILABLE.")},doh.registerString=function(t,e,r){},doh.register=doh.add=function(t,e,r){return 1==arguments.length&&"string"==typeof t&&("url:"==t.substr(0,4)?this.registerUrl(t,null,null,r):this.registerTest("ungrouped",t,r)),1==arguments.length?void this.debug("invalid args passed to doh.register():",t,",",e):"string"==typeof e?void("url:"==e.substr(0,4)?this.registerUrl(e,null,null,r):this.registerTest(t,e,r)):doh._isArray(e)?void this.registerTests(t,e,r):void this.registerTest(t,e,r)},doh.registerDocTests=function(t){this.debug("registerDocTests() requires dojo to be loaded into the environment. Skipping doctest set for module:",t)},function(){if("undefined"!=typeof dojo){try{dojo.require("dojox.testing.DocTest")}catch(t){return console.debug(t),void(doh.registerDocTests=function(){})}doh.registerDocTests=function(t){for(var e=new dojox.testing.DocTest,r=e.getTests(t),n=r.length,i=[],o=0;o<n;o++){var s=r[o],u="";if(s.commands.length&&s.commands[0].indexOf("//")!=-1){var a=s.commands[0].split("//");u=", "+a[a.length-1]}i.push({runTest:function(t){return function(r){var n=e.runTest(t.commands,t.expectedResult);r.assertTrue(n.success)}}(s),name:"Line "+s.line+u})}this.register("DocTests: "+t,i)}}}(),doh.t=doh.assertTrue=function(condition,hint){if(arguments.length<1)throw new doh._AssertFailure("assertTrue failed because it was not passed at least 1 argument");if(!eval(condition))throw new doh._AssertFailure("assertTrue('"+condition+"') failed",hint)},doh.f=doh.assertFalse=function(condition,hint){if(arguments.length<1)throw new doh._AssertFailure("assertFalse failed because it was not passed at least 1 argument");if(eval(condition))throw new doh._AssertFailure("assertFalse('"+condition+"') failed",hint)},doh.e=doh.assertError=function(t,e,r,n,i){try{e[r].apply(e,n)}catch(o){if(o instanceof t)return!0;throw new doh._AssertFailure("assertError() failed:\n\texpected error\n\t\t"+t+"\n\tbut got\n\t\t"+o+"\n\n",i)}throw new doh._AssertFailure("assertError() failed:\n\texpected error\n\t\t"+t+"\n\tbut no error caught\n\n",i)},doh.is=doh.assertEqual=function(t,e,r){if(void 0===t&&void 0===e)return!0;if(arguments.length<2)throw doh._AssertFailure("assertEqual failed because it was not passed 2 arguments");if(t===e||t==e||"number"==typeof t&&"number"==typeof e&&isNaN(t)&&isNaN(e))return!0;if(this._isArray(t)&&this._isArray(e)&&this._arrayEq(t,e))return!0;if("object"==typeof t&&"object"==typeof e&&this._objPropEq(t,e))return!0;throw new doh._AssertFailure("assertEqual() failed:\n\texpected\n\t\t"+t+"\n\tbut got\n\t\t"+e+"\n\n",r)},doh.isNot=doh.assertNotEqual=function(t,e,r){if(void 0===t&&void 0===e)throw new doh._AssertFailure("assertNotEqual() failed: not expected |"+t+"| but got |"+e+"|",r);if(arguments.length<2)throw doh._AssertFailure("assertEqual failed because it was not passed 2 arguments");if(t===e||t==e)throw new doh._AssertFailure("assertNotEqual() failed: not expected |"+t+"| but got |"+e+"|",r);if(this._isArray(t)&&this._isArray(e)&&this._arrayEq(t,e))throw new doh._AssertFailure("assertNotEqual() failed: not expected |"+t+"| but got |"+e+"|",r);if("object"==typeof t&&"object"==typeof e&&this._objPropEq(t,e))throw new doh._AssertFailure("assertNotEqual() failed: not expected |"+t+"| but got |"+e+"|",r);return!0},doh._arrayEq=function(t,e){if(t.length!=e.length)return!1;for(var r=0;r<t.length;r++)if(!doh.assertEqual(t[r],e[r]))return!1;return!0},doh._objPropEq=function(t,e){if(null===t&&null===e)return!0;if(null===t||null===e)return!1;if(t instanceof Date)return e instanceof Date&&t.getTime()==e.getTime();var r;for(r in e)if(void 0===t[r])return!1;for(r in t)if(!doh.assertEqual(t[r],e[r]))return!1;return!0},doh._isArray=function(t){return t&&t instanceof Array||"array"==typeof t||!!doh.global.dojo&&void 0!==doh.global.dojo.NodeList&&t instanceof doh.global.dojo.NodeList},doh._setupGroupForRun=function(t,e){var r=this._groups[t];this.debug(this._line),this.debug("GROUP",'"'+t+'"',"has",r.length,"test"+(r.length>1?"s":"")+" to run")},doh._handleFailure=function(t,e,r){this._groups[t].failures++;var n="";if(r instanceof this._AssertFailure?(this._failureCount++,r.fileName&&(n+=r.fileName+":"),r.lineNumber&&(n+=r.lineNumber+" "),n+=r+": "+r.message,this.debug("\t_AssertFailure:",n)):this._errorCount++,this.debug(r),e.runTest.toSource){var i=e.runTest.toSource();this.debug("\tERROR IN:\n\t\t",i)}else this.debug("\tERROR IN:\n\t\t",e.runTest);r.rhinoException?r.rhinoException.printStackTrace():r.javaException&&r.javaException.printStackTrace()},doh.setTimeout=function(t){return t()},doh._runPerfFixture=function(t,e){var r=this._groups[t];e.startTime=new Date;var n=new doh.Deferred;r.inFlight++,n.groupName=t,n.fixture=e,n.addErrback(function(r){doh._handleFailure(t,e,r)});var i,o=function(){e.tearDown&&e.tearDown(doh),r.inFlight--,!r.inFlight&&r.iterated&&doh._groupFinished(t,!r.failures),doh._testFinished(t,e,n.results[0]),doh._paused&&doh.run()},s=e.timeout;s>0&&(i=doh.setTimeout(function(){n.errback(new Error("test timeout in "+e.name.toString()))},s)),n.addBoth(function(t){i&&clearTimeout(i),o()});var u=e.results;u.trials=[];var a=doh._calcTrialIterations(t,e);return a.addErrback(function(t){e.endTime=new Date,n.errback(t)}),a.addCallback(function(r){if(r){var i=e.trialIterations;doh.debug("TIMING TEST: ["+e.name+"]\n\t\tITERATIONS PER TRIAL: "+r+"\n\tTRIALS: "+i);var o=function(){var s=new Date,a=new doh.Deferred,h={countdown:r},d=function(r){for(;r;)try{if(r.countdown--,r.countdown){var i=e.runTest(doh);if(i instanceof doh.Deferred){var o={countdown:r.countdown};i.addCallback(function(){d(o)}),i.addErrback(function(r){doh._handleFailure(t,e,r),e.endTime=new Date,n.errback(r)}),r=null}}else a.callback(new Date),r=null}catch(s){e.endTime=new Date,a.errback(s)}};a.addCallback(function(t){var a={trial:e.trialIterations-i,testIterations:r,executionTime:t.getTime()-s.getTime(),average:(t.getTime()-s.getTime())/r};if(u.trials.push(a),doh.debug("\n\t\tTRIAL #: "+a.trial+"\n\tTIME: "+a.executionTime+"ms.\n\tAVG TEST TIME: "+a.executionTime/a.testIterations+"ms."),i--,i)doh.setTimeout(o,e.trialDelay);else{u.trials;e.endTime=new Date,n.callback(!0)}}),a.addErrback(function(t){e.endTime=new Date,n.errback(t)}),d(h)};o()}}),n.fired<0&&doh.pause(),n},doh._calcTrialIterations=function(t,e){var r=new doh.Deferred,n=function(){var t=e.runTest,n={start:new Date,curIter:0,iterations:5},i=function(n){for(;n;)if(n.curIter<n.iterations)try{var o=t(doh);if(o instanceof doh.Deferred){var s={start:n.start,curIter:n.curIter+1,iterations:n.iterations};o.addCallback(function(){i(s)}),o.addErrback(function(t){e.endTime=new Date,r.errback(t)}),n=null}else n.curIter++}catch(u){return e.endTime=new Date,void r.errback(u)}else{var a=new Date,h=a.getTime()-n.start.getTime();if(h<e.trialDuration){var d={iterations:2*n.iterations,curIter:0};n=null,doh.setTimeout(function(){d.start=new Date,i(d)},50)}else{var l=n.iterations;doh.setTimeout(function(){r.callback(l)},50),n=null}}};i(n)};return doh.setTimeout(n,10),r},doh._runRegFixture=function(t,e){var r=this._groups[t];e.startTime=new Date;var n=e.runTest(this);if(e.endTime=new Date,n instanceof doh.Deferred){r.inFlight++,n.groupName=t,n.fixture=e,n.addErrback(function(r){doh._handleFailure(t,e,r)});var i=function(){e.tearDown&&e.tearDown(doh),r.inFlight--,!r.inFlight&&r.iterated&&doh._groupFinished(t,!r.failures),doh._testFinished(t,e,n.results[0]),doh._paused&&doh.run()},o=doh.setTimeout(function(){n.errback(new Error("test timeout in "+e.name.toString()))},e.timeout||1e3);return n.addBoth(function(t){clearTimeout(o),i()}),n.fired<0&&doh.pause(),n}},doh._runFixture=function(t,e){var r=this._groups[t];this._testStarted(t,e);var n=!1,i=null;try{if(e.group=r,e.setUp&&e.setUp(this),e.runTest){if("perf"===e.testType)return doh._runPerfFixture(t,e);var o=doh._runRegFixture(t,e);if(o)return o}e.tearDown&&e.tearDown(this)}catch(s){n=!0,i=s,e.endTime||(e.endTime=new Date)}var u=new doh.Deferred;return doh.setTimeout(this.hitch(this,function(){n&&this._handleFailure(t,e,i),this._testFinished(t,e,!n),!r.inFlight&&r.iterated?doh._groupFinished(t,!r.failures):r.inFlight>0&&(doh.setTimeout(this.hitch(this,function(){doh.runGroup(t)}),100),this._paused=!0),doh._paused&&doh.run()}),30),doh.pause(),u},doh._testId=0,doh.runGroup=function(t,e){var r=this._groups[t];if(r.skip!==!0&&this._isArray(r)){if(e<=r.length&&!r.inFlight&&1==r.iterated)return r.tearDown&&r.tearDown(this),void doh._groupFinished(t,!r.failures);e||(r.inFlight=0,r.iterated=!1,r.failures=0),doh._groupStarted(t),e||(this._setupGroupForRun(t,e),r.setUp&&r.setUp(this));for(var n=e||0;n<r.length;n++){if(this._paused)return void(this._currentTest=n);if(doh._runFixture(t,r[n]),this._paused)return this._currentTest=n+1,void(this._currentTest==r.length&&(r.iterated=!0))}r.iterated=!0,r.inFlight||(r.tearDown&&r.tearDown(this),doh._groupFinished(t,!r.failures))}},doh._onEnd=function(){},doh._report=function(){this.debug(this._line),this.debug("| TEST SUMMARY:"),this.debug(this._line),this.debug("\t",this._testCount,"tests in",this._groupCount,"groups"),this.debug("\t",this._errorCount,"errors"),this.debug("\t",this._failureCount,"failures")},doh.togglePaused=function(){this[this._paused?"run":"pause"]()},doh.pause=function(){this._paused=!0},doh.run=function(){this._paused=!1;var t=this._currentGroup,e=this._currentTest,r=!1;t||(this._init(),r=!0),this._currentGroup=null,this._currentTest=null;for(var n in this._groups)if(!r&&n==t||r){if(this._paused)return;if(this._currentGroup=n,r?this.runGroup(n):(r=!0,this.runGroup(n,e)),this._paused)return}this._currentGroup=null,this._currentTest=null,this._paused=!1,this._onEnd(),this._report()},doh.standardDeviation=function(t){return Math.sqrt(this.variance(t))},doh.variance=function(t){var e=0,r=0;return dojo.forEach(t,function(t){e+=t,r+=Math.pow(t,2)}),r/t.length-Math.pow(e/t.length,2)},doh.mean=function(t){var e=0;return dojo.forEach(t,function(t){e+=t}),e/Math.max(t.length,1)},doh.min=function(t){return Math.min.apply(null,t)},doh.max=function(t){return Math.max.apply(null,t)},doh.median=function(t){return t.slice(0).sort()[Math.ceil(t.length/2)-1]},doh.mode=function(t){var e={},r=0,n=Number.MIN_VALUE;dojo.forEach(t,function(t){void 0!==e[t]?e[t]++:e[t]=1});for(var i in e)n<e[i]&&(n=e[i],r=i);return r},doh.average=function(t){var e,r=0;for(e=0;e<t.length;e++)r+=t[e];return r/t.length},tests=doh,"undefined"==typeof skipDohSetup&&function(){var t;try{if("undefined"!=typeof dojo){dojo.platformRequire({browser:["doh._browserRunner"],rhino:["doh._rhinoRunner"],spidermonkey:["doh._rhinoRunner"]});try{var e=!dojo.isBrowser||(dojo.global==dojo.global.parent||!Boolean(dojo.global.parent.doh))}catch(r){e=!0}e&&dojo.isBrowser&&dojo.addOnLoad(function(){if(dojo.global.registerModulePath&&dojo.forEach(dojo.global.registerModulePath,function(t){dojo.registerModulePath(t[0],t[1])}),dojo.byId("testList")){var t=dojo.global.testModule&&dojo.global.testModule.length?dojo.global.testModule:"dojo.tests.module";dojo.forEach(t.split(","),dojo.require,dojo),doh.setTimeout(function(){doh.run()},500)}})}else{if("function"==typeof load&&("function"==typeof Packages||"object"==typeof Packages))throw new Error;if("function"==typeof load)throw new Error;this.document}}catch(r){print("\n"+doh._line),print("The Dojo Unit Test Harness, $Rev: 20389 $"),print("Copyright (c) 2009, The Dojo Foundation, All Rights Reserved"),print(doh._line,"\n");try{var n="../../dojo/dojo.js",i="",o="dojo.tests.module",s="";for(t=0;t<arguments.length;t++)if(arguments[t].indexOf("=")>0){var u=arguments[t].split("=");"dohBase"==u[0]&&(s=u[1],s=s.replace(/\\/g,"/"),"/"!=s.charAt(s.length-1)&&(s+="/")),"dojoUrl"==u[0]&&(n=u[1]),"testUrl"==u[0]&&(i=u[1]),"testModule"==u[0]&&(o=u[1])}load(s+"_rhinoRunner.js"),n.length&&(this.djConfig||(djConfig={}),djConfig.baseUrl=n.split("dojo.js")[0],load(n)),i.length&&load(i),o.length&&dojo.forEach(o.split(","),dojo.require,dojo)}catch(r){print("An exception occurred: "+r)}doh.run()}}.apply(this,"undefined"!=typeof arguments?arguments:[null]);