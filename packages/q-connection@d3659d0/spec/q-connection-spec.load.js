montageDefine("d3659d0","spec/q-connection-spec",{dependencies:["./lib/jasmine-promise","q","q/queue","../q-connection"],factory:function(e,t,n){function o(){var e=c(),t=c();return{l2r:{get:e.get,put:t.put},r2l:{get:t.get,put:e.put}}}function r(e,t){var n=o();return{local:u(n.l2r,e),remote:u(n.r2l,t)}}e("./lib/jasmine-promise");var i=e("q"),c=e("q/queue"),u=e("../q-connection");describe("channel",function(){it("should send messages",function(){var e=o();e.l2r.put(10),e.r2l.put(20);var t=e.l2r.get().then(function(e){expect(e).toBe(20)}),n=e.r2l.get().then(function(e){expect(e).toBe(10)});return i.all([t,n])})}),describe("get",function(){it("should get the value of a remote property",function(){var e=r({a:10});return e.remote.get("a").then(function(e){expect(e).toBe(10)})})}),describe("set",function(){it("should set the value for a remote property",function(){var e={a:10},t=r(e);return t.remote.set("a",20).then(function(t){expect(t).toBe(void 0),expect(e.a).toBe(20)})})}),describe("delete",function(){it("should delete a remote property",function(){var e={a:10},t=r(e);return t.remote["delete"]("a").then(function(t){expect(t).toBe(void 0),expect(e.a).toBe(void 0)})})}),describe("keys",function(){it("should get the keys of a remote object",function(){var e=r({a:10,b:20});return e.remote.keys().then(function(e){expect(e).toEqual(["a","b"])})})}),describe("invoke",function(){it("should invoke a remote method",function(){var e={add:function(e,t){return e+t}},t=r(e);return t.remote.invoke("add",2,3).then(function(e){expect(e).toBe(5)})})}),describe("post",function(){it("should invoke a remote method",function(){var e={add:function(e,t){return e+t}},t=r(e);return t.remote.post("add",[2,3]).then(function(e){expect(e).toBe(5)})})}),describe("fcall",function(){it("should call a remote function",function(){var e=function(e,t){return e+t},t=r(e);return t.remote.fcall(2,3).then(function(e){expect(e).toBe(5)})})}),describe("fapply",function(){it("should call a remote function",function(){var e=function(e,t){return e+t},t=r(e);return t.remote.fapply([2,3]).then(function(e){expect(e).toBe(5)})})}),describe("bidirectional communication",function(){it("should pass local promises to the remote",function(){var e={bar:function(e,t){return expect(e).toBe("a"),expect(t).toBe("b"),10}},t={foo:function(e){return expect(i.isPromise(e)).toBe(!0),e.invoke("bar","a","b")}},n=r(t,e);return n.remote.invoke("foo",n.local).then(function(e){expect(e).toBe(10)})})}),describe("remote promises that fulfill to functions",function(){it("should become local functions",function(){var e=r({respond:function(e){return e("World")}});return e.remote.invoke("respond",function(e){return"Hello, "+e+"!"}).then(function(e){expect(e).toBe("Hello, World!")})})}),describe("rejection",function(){it("should become local functions",function(){var e=r({respond:function(){throw new Error("No!")}});return e.remote.invoke("respond").then(function(){expect(!0).toBe(!1)})["catch"](function(e){expect(e.message).toBe("No!")})})}),describe("serialization",function(){it("should serialize null",function(){var e=r({respond:function(e){return null===e}});return e.remote.invoke("respond",null).then(function(e){expect(e).toBe(!0)})}),it("should serialize undefined",function(){var e=r({respond:function(e){return void 0===e}});return e.remote.invoke("respond",void 0).then(function(e){expect(e).toBe(!0)})}),it("should serialize special key names",function(){var e={"@":1,"@@":2,"!":3,"!!":4,"%":5,"%%":6,"\\@":7,"\\":8},t=r({respond:function(t){return e}});return t.remote.invoke("respond").then(function(t){expect(t).toEqual(e)})})})}});