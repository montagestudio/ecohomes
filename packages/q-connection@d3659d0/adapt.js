function adapt(e,t){var n;if(e.postMessage)n=function(n){e.postMessage(n,t)};else{if(!e.send){if(e.get&&e.put)return e;throw new Error("An adaptable message port required")}var s=Q.defer();n=s.promise,e.on?s.resolve(e.send):e.addEventListener&&(e.addEventListener("open",function(){s.resolve(e.send)}),e.addEventListener("close",function(){r.close(),s.reject("Connection closed.")}))}var r=Queue();e.on?e.on("message",function(e){r.put(e)},!1):e.addEventListener?e.addEventListener("message",function(e){r.put(e.data)},!1):e.onmessage=function(e){r.put(e.data)},e.start&&e.start();var o=function(){return e.close&&e.close(),r.close()};return{get:r.get,put:function(t){return Q.invoke(n,"call",e,t)},close:o,closed:r.closed}}var Q=require("q"),Queue=require("q/queue");module.exports=adapt;