montageDefine("c50fb48","runtime/transform",{dependencies:["runtime/dependencies/gl-matrix","runtime/base","runtime/utilities"],factory:function(t,i,e){t("runtime/dependencies/gl-matrix");var a=t("runtime/base").Base,r=t("runtime/utilities").Utilities,s=i.Transform=Object.create(a,{_matrix:{value:null,writable:!0},_dirty:{value:!0,writable:!0},_dirtyAffines:{value:!0,writable:!0},_translation:{value:null,writable:!0},_rotation:{value:null,writable:!0},_scale:{value:null,writable:!0},_id:{value:0,writable:!0},_fireTransformDidUpdate:{value:function(t){if(this._observers)for(var i=0;i<this._observers.length;i++)this._observers[i].transformDidUpdate(this)}},_updateDirtyFlag:{value:function(t){this._dirty=t,this._fireTransformDidUpdate()}},interpolateToTransform:{value:function(t,i,e){i=r.easeOut(i),r.interpolateVec(this._translation,t._translation,i,e._translation),r.interpolateVec(this._scale,t._scale,i,e._scale),r.inverpolateAxisAngle(this._rotation,t._rotation,i,e._rotation),e._updateDirtyFlag(!0)}},matrix:{get:function(){return this._dirty&&(null==this._matrix&&(this._matrix=mat4.create()),null==this._intermediateMatrices&&(this._intermediateMatrices=[],this._intermediateMatrices.push(mat4.identity()),this._intermediateMatrices.push(mat4.identity()),this._intermediateMatrices.push(mat4.identity()),this._intermediateMatrices.push(mat4.identity())),mat4.identity(this._matrix),mat4.identity(this._intermediateMatrices[0]),mat4.set(this._intermediateMatrices[0],this._intermediateMatrices[1]),mat4.set(this._intermediateMatrices[0],this._intermediateMatrices[2]),mat4.set(this._intermediateMatrices[0],this._intermediateMatrices[3]),mat4.translate(this._intermediateMatrices[1],this._translation),mat4.scale(this._intermediateMatrices[2],this._scale),quat4.toMat4(this._rotation,this._intermediateMatrices[3]),mat4.multiply(this._matrix,this._intermediateMatrices[1]),mat4.multiply(this._matrix,this._intermediateMatrices[2]),mat4.multiply(this._matrix,this._intermediateMatrices[3]),this._dirty=!1),this._matrix},set:function(t){null==this._matrix&&(this._matrix=mat4.create()),mat4.set(t,this._matrix),this._dirty=!1,this._dirtyAffines=!0}},_rebuildAffinesIfNeeded:{value:function(){this._dirtyAffines===!0&&(r.decomposeMat4(this.matrix,this._translation,this._rotation,this._scale),this._dirtyAffines=!1)}},translation:{set:function(t){this._translation=t,this._updateDirtyFlag(!0)},get:function(t){return this._rebuildAffinesIfNeeded(),this._translation}},rotation:{set:function(t){this._rotation=t,this._updateDirtyFlag(!0)},get:function(t){return this._rebuildAffinesIfNeeded(),this._rotation}},scale:{set:function(t){this._scale=t,this._updateDirtyFlag(!0)},get:function(t){return this._rebuildAffinesIfNeeded(),this._scale}},_commonInit:{value:function(){this.translation=vec3.createFrom(0,0,0),this.rotation=vec4.createFrom(0,0,0,0),this.scale=vec3.createFrom(1,1,1),this.matrix=mat4.identity(),this._id=s.bumpId()}},initWithDescription:{value:function(t){if(this._commonInit(),t.matrix)this.matrix=mat4.create(t.matrix);else if(t.translation||t.rotation||t.scale){this.translation=t.translation?vec3.create(t.translation):vec3.createFrom(0,0,0);var i=t.rotation;this.rotation=i?quat4.fromAngleAxis(i[3],vec3.createFrom(i[0],i[1],i[2])):vec4.createFrom(0,0,0,0),this.scale=t.scale?vec3.create(t.scale):vec3.createFrom(1,1,1)}else this.matrix=mat4.identity();return this}},init:{value:function(){return this._commonInit(),this}},bumpId:{value:function(){return s._id++,s._id}},copy:{value:function(){var t=Object.create(s).init();return this._translation&&(t.translation=vec3.createFrom(this._translation[0],this._translation[1],this._translation[2])),this._scale&&(t.scale=vec3.createFrom(this._scale[0],this._scale[1],this._scale[2])),this._rotation&&(t.rotation=quat4.create(this._rotation)),t.matrix=mat4.create(this.matrix),t}},_observers:{value:null,writable:!0},addObserver:{value:function(t){null==this._observers&&(this._observers=[]),this._observers.indexOf(t)===-1?this._observers.push(t):console.log("WARNING attempt to add 2 times the same observer in transform")}},removeObserver:{value:function(t){if(this._observers){var i=this._observers.indexOf(t);i!==-1&&this._observers.splice(i,1)}}}})}});