montageDefine("c50fb48","runtime/dependencies/camera",{dependencies:[],factory:function(t,e,i){var s=window;!function(t,a){"object"==typeof e?(i.exports=a(s),i.exports.OrbitCamera=i.exports.OrbitCamera,i.exports.FlyingCamera=i.exports.FlyingCamera):"function"==typeof define&&define.amd?define([],function(){return a(t)}):a(t)}(this,function(t){"use strict";function e(t){return Math.abs(t)>.35?t:0}var i,s;return i=function(t){this._distance=vec3.createFrom(0,0,-32),this._center=vec3.create(),this._viewMat=mat4.create(),this._yUp=!0,this._rideMode=!1,this.orbitX=0,this.orbitY=0,this.maxOrbitX=.5*Math.PI,this.minOrbitX=.5*-Math.PI,this.maxOrbitY=Math.PI,this.minOrbitY=-Math.PI,this.constrainXOrbit=!0,this.constrainYOrbit=!1,this.maxDistance=512,this.minDistance=16,this.distanceStep=1,this.constrainDistance=!0,this.ignoreEvents=!1,this._dirty=!0,this._hookEvents(t)},i.prototype._hookEvents=function(t){var e,i,s=this,a=!1;t.addEventListener("mousedown",function(t){1===t.which&&(a=!0),e=t.pageX,i=t.pageY},!1),t.addEventListener("mousemove",function(t){if(a){var n=t.pageX-e,r=t.pageY-i;e=t.pageX,i=t.pageY,s.orbit(.013*n,.013*r)}},!1),t.addEventListener("mouseup",function(){a=!1},!1),t.addEventListener("mousewheel",function(t){s.setDistance(-s._distance[2]+t.wheelDeltaY*s.distanceStep),t.preventDefault()},!1),t.addEventListener("touchstart",function(t){var s=t.touches;switch(s.length){case 1:a=!0,e=s[0].pageX,i=s[0].pageY;break;case 2:break;default:return}t.stopPropagation(),t.preventDefault()},!1),t.addEventListener("touchmove",function(t){var n=t.touches;if(a&&!ignoreEvents){var r=n[0].pageX-e,o=n[0].pageY-i;e=n[0].pageX,i=n[0].pageY,s.orbit(.005*r,.005*o)}t.stopPropagation(),t.preventDefault()},!1),t.addEventListener("touchend",function(t){a=!1,t.stopPropagation(),t.preventDefault()},!1),t.addEventListener("gesturestart",function(t){a=!1,s.initialDistance=s._distance[2],t.preventDefault()},!1),t.addEventListener("gesturechange",function(t){document.getElementsByTagName("header")[0].innerHTML=t.scale+" "+s.initialDistance+" "+s.initialDistance*t.scale,s.setDistance(s.initialDistance*(100*t.scale)),t.preventDefault()},!1),t.addEventListener("gestureend",function(t){t.preventDefault()},!1)},i.prototype.orbit=function(t,e){if(t||e){if(this.orbitY+=t,this.constrainYOrbit)this.orbitY=Math.min(Math.max(this.orbitY,this.minOrbitY),this.maxOrbitY);else{for(;this.orbitY<-Math.PI;)this.orbitY+=2*Math.PI;for(;this.orbitY>=Math.PI;)this.orbitY-=2*Math.PI}if(this.orbitX+=e,this.constrainXOrbit)this.orbitX=Math.min(Math.max(this.orbitX,this.minOrbitX),this.maxOrbitX);else{for(;this.orbitX<-Math.PI;)this.orbitX+=2*Math.PI;for(;this.orbitX>=Math.PI;)this.orbitX-=2*Math.PI}this._dirty=!0}},i.prototype.getCenter=function(){return[-this._center[0],-this._center[1],-this._center[2]]},i.prototype.setCenter=function(t){this._center[0]=-t[0],this._center[1]=-t[1],this._center[2]=-t[2],this._dirty=!0},i.prototype.getDistance=function(){return-this._distance[2]},i.prototype.setDistance=function(t){this._distance[2]=-t,this.constrainDistance&&(this._distance[2]=Math.min(Math.max(-this._distance[2],this.minDistance),this.maxDistance)*-1),this._dirty=!0},i.prototype.getYUp=function(){return this._yUp},i.prototype.setYUp=function(t){this._yUp=t,this._dirty=!0},i.prototype.getRideMode=function(){return this._rideMode},i.prototype.setRideMode=function(t){this._rideMode=t,this._dirty=!0},i.prototype.setCenter=function(t){this._center[0]=-t[0],this._center[1]=-t[1],this._center[2]=-t[2],this._dirty=!0},i.prototype.getViewMat=function(){if(this._dirty){var t=this._viewMat;mat4.identity(t),mat4.translate(t,this._distance),0==this._rideMode?(mat4.rotateX(t,this.orbitX),mat4.rotateY(t,this.orbitY)):(mat4.rotateY(t,this.orbitY),mat4.rotateX(t,this.orbitX)),0==this._rideMode&&mat4.rotateX(t,.5*-Math.PI),mat4.translate(t,this._center),this._yUp||mat4.rotateX(t,.5*Math.PI),this._dirty=!1}return this._viewMat},i.prototype.update=function(){var t,i;for(i=0;i<navigator.gamepads.length;++i)t=navigator.gamepads[i],t&&(t.id.indexOf("Space Navigator")!=-1?this.orbit(e(t.axes[4])*-.05,e(t.axes[3])*-.05):(this.orbit(.05*e(t.axes[0]),.05*e(t.axes[1])),this.orbit(.05*e(t.axes[2]),.05*e(t.axes[3]))))},s=function(t){this._angles=vec2.create(),this._position=vec3.create(),this.speed=100,this._pressedKeys=new Array(128),this._viewMat=mat4.create(),this._rotMat=mat4.create(),this._dirty=!0,this._hookEvents(t)},s.prototype._hookEvents=function(t){var e,i,s=this,a=!1;t.tabIndex=0,t.addEventListener("keydown",function(t){if(s._pressedKeys[t.keyCode]=!0,32==t.keyCode)return t.preventDefault(),!1},!0),t.addEventListener("keyup",function(t){s._pressedKeys[t.keyCode]=!1},!1),t.addEventListener("mousedown",function(t){1===t.which&&(a=!0),e=t.pageX,i=t.pageY},!1),t.addEventListener("mousemove",function(t){var n,r;document.pointerLockEnabled?(n=t.movementX,r=t.movementY,s.rotateView(.025*n,.025*r)):a&&(n=t.pageX-e,r=t.pageY-i,e=t.pageX,i=t.pageY,s.rotateView(.025*n,.025*r))},!1),t.addEventListener("mouseup",function(){a=!1},!1)},s.prototype.rotateView=function(t,e){var i=this._rotMat;if(t||e){for(this._angles[1]+=t,this.constrainYRotation&&(this._angles[1]=Math.min(Math.max(this._angles[1],this.minYRotation),this.maxYRotation));this._angles[1]<0;)this._angles[1]+=2*Math.PI;for(;this._angles[1]>=2*Math.PI;)this._angles[1]-=2*Math.PI;this._angles[0]+=e,this._angles[0]<.5*-Math.PI&&(this._angles[0]=.5*-Math.PI),this._angles[0]>.5*Math.PI&&(this._angles[0]=.5*Math.PI),mat4.identity(i),mat4.rotateZ(i,-this._angles[1]),mat4.rotateX(i,-this._angles[0]),this._dirty=!0}},s.prototype.getAngles=function(){return[this._angles[0],this._angles[1]]},s.prototype.setAngles=function(t){this._angles[0]=t[0],this._angles[1]=t[1],this._dirty=!0},s.prototype.getPosition=function(){return[this._position[0],this._position[1],this._position[2]]},s.prototype.setPosition=function(t){this._position[0]=t[0],this._position[1]=t[1],this._position[2]=t[2],this._dirty=!0},s.prototype.getViewMat=function(){if(this._dirty){var t=this._viewMat;mat4.identity(t),mat4.rotateY(t,this._angles[1]),mat4.rotateX(t,this._angles[0]),mat4.translate(t,[-this._position[0],-this._position[1],-this._position[2]]),this._dirty=!1}return this._viewMat},s.prototype.update=function(t){var i,s,a=vec3.create(),n=this.speed/1e3*t;for(this._pressedKeys["W".charCodeAt(0)]&&(a[1]+=n),this._pressedKeys["S".charCodeAt(0)]&&(a[1]-=n),this._pressedKeys["A".charCodeAt(0)]&&(a[0]-=n),this._pressedKeys["D".charCodeAt(0)]&&(a[0]+=n),this._pressedKeys[32]&&(a[2]+=n),this._pressedKeys[17]&&(a[2]-=n),s=0;s<navigator.gamepads.length;++s)i=navigator.gamepads[s],i&&(i.id.indexOf("Space Navigator")!=-1?(a[0]+=e(i.axes[0])*n,a[1]+=e(i.axes[1])*-n,a[2]+=e(i.axes[2])*-n,this.rotateView(.05*e(i.axes[4]),e(i.axes[3])*-.05)):(a[0]+=e(i.axes[0])*n,a[1]+=e(i.axes[1])*n,this.rotateView(.05*e(i.axes[2]),.05*e(i.axes[3]))));0===a[0]&&0===a[1]&&0===a[2]||(mat4.multiplyVec3(this._rotMat,a),vec3.add(this._position,a),this._dirty=!0)},t&&(t.OrbitCamera=i,t.FlyingCamera=s),{OrbitCamera:i,FlyingCamera:s}})}});