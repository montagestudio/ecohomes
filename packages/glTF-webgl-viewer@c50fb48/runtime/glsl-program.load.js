montageDefine("c50fb48","runtime/glsl-program",{dependencies:["runtime/dependencies/gl-matrix"],factory:function(e,t,o){e("runtime/dependencies/gl-matrix");var n=t.GLSLProgram=Object.create(Object.prototype,{VERTEX_SHADER:{value:"x-shader/x-vertex"},FRAGMENT_SHADER:{value:"x-shader/x-fragment"},_GLTypes:{enumerable:!1,value:null,writable:!0},_shaders:{enumerable:!1,value:null,writable:!0},shaders:{enumerable:!1,get:function(){return this._shaders},set:function(e){this._shaders=e}},_errorLogs:{enumerable:!1,value:null,writable:!0},errorLogs:{enumerable:!1,get:function(){return this._errorLogs},set:function(e){this._errorLogs=e}},_pendingCommits:{value:null,writable:!0},pendingCommits:{get:function(){return this._pendingCommits},set:function(e){this._pendingCommits=e}},_symbolToLocation:{value:null,writable:!0},symbolToLocation:{enumerable:!1,get:function(){return this._symbolToLocation},set:function(e){this._symbolToLocation=e}},_symbolToActiveInfo:{enumerable:!1,value:null,writable:!0},symbolToActiveInfo:{get:function(){return this._symbolToActiveInfo},set:function(e){this._symbolToActiveInfo=e}},_semanticToSymbol:{value:null,writable:!0},semanticToSymbol:{enumerable:!1,get:function(){return this._semanticToSymbol},set:function(e){this._semanticToSymbol=e}},_symbolToSemantic:{value:null,writable:!0},symbolToSemantic:{get:function(){return this._symbolToSemantic},set:function(e){this._symbolToSemantic=e}},_symbolToValue:{value:null,writable:!0},symbolToValue:{get:function(){return this._symbolToValue},set:function(e){this._symbolToValue=e}},_uniformSymbols:{value:null,writable:!0},uniformSymbols:{enumerable:!1,get:function(){return this._uniformSymbols},set:function(e){this._uniformSymbols=e}},_attributeSymbols:{value:null,writable:!0},attributeSymbols:{enumerable:!1,get:function(){return this._attributeSymbols},set:function(e){this._attributeSymbols=e}},_GLProgram:{enumerable:!1,value:null,writable:!0},GLProgram:{enumerable:!1,get:function(){return this._GLProgram},set:function(e){this._GLProgram=e}},getTypeForSymbol:{value:function(e){var t=null,o=this.symbolToActiveInfo[e];return o&&(t=o.type),t}},getLocationForSymbol:{value:function(e){return this.symbolToLocation[e]}},getSymbolForSemantic:{value:function(e){return this.semanticToSymbol[e]}},setSymbolForSemantic:{value:function(e,t){if("none"===e&&(e=null),"none"===t&&(t=null),!this.symbolToActiveInfo[e])return!1;if(t&&this.semanticToSymbol[t])return!1;if(e){var o=this.symbolToSemantic[e];o&&o!==t&&(this.semanticToSymbol[o]=null),this.symbolToSemantic[e]=t}return t&&(this.semanticToSymbol[t]=e),!0}},setSemanticForSymbol:{value:function(e,t){this.setSymbolForSemantic(e,t)}},getSemanticForSymbol:{value:function(e){return this.symbolToSemantic[e]}},setValueForSymbol:{value:function(e,t){var o=this.symbolToValue[e],n=this.getTypeForSymbol(e),i=this._GLTypes;if(null!=t&&null!=o){if(n===i.FLOAT&&t===o)return;if(n===i.FLOAT_MAT4){if(16==t.length&&mat4.equal(o,t))return}else if(n===i.FLOAT_MAT3){if(9==t.length&&mat3.equal(o,t))return}else if(n===i.FLOAT_VEC3){if(3==t.length&&vec3.equal(o,t))return}else if(n===i.FLOAT_VEC4){if(4==t.length&&vec4.equal(o,t))return}else if(n===i.FLOAT_VEC2&&2==t.length&&vec4.equal(o,t))return}else n===i.FLOAT_MAT4?o=mat4.create():n===i.FLOAT_MAT3?o=mat3.create():n===i.FLOAT_VEC3?o=vec3.create():n===i.FLOAT_VEC4?o=vec4.create():n===i.FLOAT_VEC2&&(o=vec2.create());null!==this.symbolToActiveInfo[e]&&this.pendingCommits.indexOf(e)===-1&&this.pendingCommits.push(e),null!=t&&(n===i.FLOAT_MAT4?t=mat4.set(t,o):n===i.FLOAT_MAT3?t=mat3.set(t,o):n===i.FLOAT_VEC3?t=vec3.set(t,o):n===i.FLOAT_VEC4?t=vec4.set(t,o):n===i.FLOAT_VEC2&&(t=vec2.set(t,o))),this.symbolToValue[e]=t}},getValueForSymbol:{value:function(e){return this.symbolToValue[e]}},_commitSwitch:{value:function(){var e=[];return e[WebGLRenderingContext.prototype.FLOAT_MAT2]=function(e,t,o,n){e.uniformMatrix2fv(t,o,n)},e[WebGLRenderingContext.prototype.FLOAT_MAT3]=function(e,t,o,n){e.uniformMatrix3fv(t,o,n)},e[WebGLRenderingContext.prototype.FLOAT_MAT4]=function(e,t,o,n){e.uniformMatrix4fv(t,o,n)},e[WebGLRenderingContext.prototype.FLOAT]=function(e,t,o,n){e.uniform1f(t,n)},e[WebGLRenderingContext.prototype.FLOAT_VEC2]=function(e,t,o,n){e.uniform2fv(t,n)},e[WebGLRenderingContext.prototype.FLOAT_VEC3]=function(e,t,o,n){e.uniform3fv(t,n)},e[WebGLRenderingContext.prototype.FLOAT_VEC4]=function(e,t,o,n){e.uniform4fv(t,n)},e[WebGLRenderingContext.prototype.INT]=function(e,t,o,n){e.uniform1i(t,n)},e[WebGLRenderingContext.prototype.SAMPLER_2D]=function(e,t,o,n){e.uniform1i(t,n)},e[WebGLRenderingContext.prototype.SAMPLER_CUBE]=function(e,t,o,n){e.uniform1i(t,n)},e}()},commit:{value:function(e){if(this.pendingCommits.length){for(var t,o=this.pendingCommits.length-1;t=this.pendingCommits[o--];)this._commitSwitch[this.getTypeForSymbol(t)](e,this.symbolToLocation[t],!1,this.getValueForSymbol(t));this.pendingCommits.length=0}}},use:{value:function(e,t){e.useProgram(this.GLProgram),t&&this.commit(e)}},createShaderWithSourceAndType:{value:function(e,t,o){var n;if("x-shader/x-fragment"===o)n=e.createShader(e.FRAGMENT_SHADER);else{if("x-shader/x-vertex"!==o)return null;n=e.createShader(e.VERTEX_SHADER)}return e.shaderSource(n,t),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)?n:(this.errorLogs=e.getShaderInfoLog(n),null)}},build:{value:function(e){var t,o,i=this.shaders[n.VERTEX_SHADER],r=this.shaders[n.FRAGMENT_SHADER],s=!1,a=this.createShaderWithSourceAndType(e,i,n.VERTEX_SHADER);if(null==a)return!1;var m=this.createShaderWithSourceAndType(e,r,n.FRAGMENT_SHADER);if(null==m)return!1;if(this.GLProgram=e.createProgram(),e.attachShader(this.GLProgram,a),e.attachShader(this.GLProgram,m),e.linkProgram(this.GLProgram),e.getProgramParameter(this.GLProgram,e.LINK_STATUS)){this.pendingCommits=[],this.symbolToActiveInfo={},this.symbolToValue={},this.symbolToLocation={},this.uniformSymbols=[],this.attributeSymbols=[],this.symbolToSemantic={},this.semanticToSymbol={},this._GLTypes={FLOAT:e.FLOAT,FLOAT_MAT4:e.FLOAT_MAT4,FLOAT_MAT3:e.FLOAT_MAT3,FLOAT_VEC3:e.FLOAT_VEC3,FLOAT_VEC2:e.FLOAT_VEC2,FLOAT_VEC4:e.FLOAT_VEC4};var l=e.getParameter(e.CURRENT_PROGRAM);e.useProgram(this.GLProgram);var u=e.getProgramParameter(this.GLProgram,e.ACTIVE_UNIFORMS);for(t=0;t<u;t++){o=e.getActiveUniform(this.GLProgram,t);var c=o.name,h=c.indexOf("[0]");h!=-1&&(c=c.substring(0,h)),this.symbolToActiveInfo[c]=o,this.symbolToLocation[c]=e.getUniformLocation(this.GLProgram,c),this.uniformSymbols.push(c)}var T=e.getProgramParameter(this.GLProgram,e.ACTIVE_ATTRIBUTES);for(t=0;t<T;t++)o=e.getActiveAttrib(this.GLProgram,t),this.symbolToActiveInfo[o.name]=o,this.symbolToLocation[o.name]=e.getAttribLocation(this.GLProgram,o.name),this.attributeSymbols.push(o.name);s=!0,e.useProgram(l)}return this.errorLogs=e.getProgramInfoLog(this.GLProgram),s}},initWithShaders:{value:function(e){this.shaders=e}},initWithProgram:{value:function(e){this.shaders=e.shaders,this.semanticToSymbol=e.semanticToSymbol,this.symbolToSemantic=e.symbolToSemantic}}})}});