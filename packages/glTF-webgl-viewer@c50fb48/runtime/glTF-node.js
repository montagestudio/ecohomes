require("runtime/dependencies/gl-matrix");var Base=require("runtime/base").Base,Transform=require("runtime/transform").Transform,Utilities=require("runtime/utilities").Utilities,glTFNode=exports.glTFNode=Object.create(Base,{currentId:{value:0,writable:!0},bumpId:{value:function(){return glTFNode._id++}},_children:{value:null,writable:!0},children:{get:function(){return this._children},set:function(t){this._children=t}},_id:{value:null,writable:!0},id:{get:function(){return this._id},set:function(t){this._id=t}},_hidden:{value:null,writable:!0},hidden:{get:function(){return this._hidden},set:function(t){this._hidden=t}},_computeBBOXIfNeeded:{enumerable:!1,value:function(){if(!this._boundingBox){var t=(this._properties.meshes,this.meshes.length);if(t>0){var e=this.meshes[0].boundingBox;if(e){var i;for(i=1;i<t;i++){var r=this.meshes[i].boundingBox;r&&(e=Utilities.mergeBBox(e,r))}this._boundingBox=e}}}}},_boundingBox:{enumerable:!1,value:null,writable:!0},boundingBox:{enumerable:!0,get:function(){return this._computeBBOXIfNeeded(),this._boundingBox},set:function(t){this._boundingBox=t}},meshesDidChange:{value:function(t){this._boundingBox=null}},nodesDidChange:{value:function(t){}},_parent:{value:null,writable:!0},parent:{get:function(){return this._parent}},init:{value:function(){this.__Base_init(),this._children=[],this._transform=Object.create(Transform).init(),this._properties.meshes=[];var t=this;return this._properties.meshes.push=function(e){var i=Array.prototype.push.call(this,e);return t.meshesDidChange(this),i},this._children.push=function(e){var i=Array.prototype.push.call(this,e);return e._parent=t,t.nodesDidChange(this),i},this._properties.cameras=[],this._properties.lights=[],this._worldMatrixIsDirty=!0,this._worldMatrix=mat4.create(),this}},getPropertyArrayNamed:{value:function(t){return this._properties[t]}},_observers:{value:null,writable:!0},addObserver:{value:function(t){null==this._observers&&(this._observers=[]),this._observers.indexOf(t)===-1?this._observers.push(t):console.log("WARNING attempt to add 2 times the same observer in transform")}},removeObserver:{value:function(t){if(this._observers){var e=this._observers.indexOf(t);e!==-1&&this._observers.splice(e,1)}}},_transform:{value:null,writable:!0},transform:{get:function(){return this._transform},set:function(t){if(this._observers)for(var e=0;e<this._observers.length;e++)this._observers[e].transformWillChange(this,this._transform,t);if(this._transform&&this._transform.removeObserver(this),this._transform=t,this._invalidateWorldMatrix(),this._transform&&this._transform.addObserver(this),this._observers)for(var e=0;e<this._observers.length;e++)this._observers[e].transformDidChange(this)}},meshes:{get:function(){return this.getPropertyArrayNamed("meshes")},set:function(t){this._properties.meshes=t,this.meshesDidChange(t)}},cameras:{get:function(){return this.getPropertyArrayNamed("cameras")},set:function(t){this._properties.cameras=t}},lights:{get:function(){return this.getPropertyArrayNamed("lights")},set:function(t){this._properties.lights=t}},_apply:{value:function(t,e,i,r){t&&(r=t(this,i,r),e&&this.children.forEach(function(i){i._apply(t,e,this,r)},this))}},apply:{value:function(t,e,i){this._apply(t,e,null,i)}},_nodeWithName:{value:function(t){if(this.name===t)return this;if(this.children)for(var e=0;e<this.children.length;e++){var i=this.children[e],r=i._nodeWithName(t);if(r)return r}return null}},nodeWithName:{value:function(t){return this._nodeWithName(t)}},_nodeWithID:{value:function(t){if(this.id===t)return this;if(this.children)for(var e=0;e<this.children.length;e++){var i=this.children[e],r=i._nodeWithID(t);if(r)return r}return null}},nodeWithJointID:{value:function(t){return this._nodeWithJointID(t)}},_nodeWithJointID:{value:function(t){if(this.jointId===t)return this;if(this.children)for(var e=0;e<this.children.length;e++){var i=this.children[e],r=i._nodeWithJointID(t);if(r)return r}return null}},nodeWithID:{value:function(t){return this._nodeWithID(t)}},copy:{value:function(t){var t=Object.create(glTFNode).init();return t.name=this.name,this.meshes&&this.meshes.forEach(function(e){t.meshes.push(e)},this),this.lights&&this.lights.forEach(function(e){t.lights.push(e)},this),this.cameras&&this.cameras.forEach(function(e){t.cameras.push(e)},this),t.id=this.id+"-"+this.bumpId(),t.transform=this.transform.copy(),t}},_worldMatrixIsDirty:{value:!0,writable:!0},_worldMatrix:{value:null,writable:!0},worldMatrix:{get:function(){return this.parent?(this._worldMatrixIsDirty&&(mat4.multiply(this.parent.worldMatrix,this.transform.matrix,this._worldMatrix),this._worldMatrixIsDirty=!1),this._worldMatrix):(this._worldMatrixIsDirty=!1,this.transform.matrix)}},_ignoresTransformUpdates:{value:!1,writable:!0},_invalidateWorldMatrix:{value:function(){if(this._worldMatrixIsDirty=!0,this._ignoresTransformUpdates=!0,this._transform._fireTransformDidUpdate(),this._ignoresTransformUpdates=!1,this._children)for(var t=0;t<this._children.length;t++)this._children[t]._invalidateWorldMatrix()}},transformDidUpdate:{value:function(){this._ignoresTransformUpdates===!1&&this._invalidateWorldMatrix()}},nodeWithJointID:{value:function(t){return this._nodeWithJointID(t)}},nodeWithPropertyNamed:{value:function(t){if("undefined"!=typeof this[t]&&null!=this[t])return this;if(this.children)for(var e=0;e<this.children.length;e++){var i=this.children[e],r=i.nodeWithPropertyNamed(t);if(r)return r}return null}}});