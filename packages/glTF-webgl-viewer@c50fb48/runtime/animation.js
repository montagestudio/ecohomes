require("runtime/dependencies/gl-matrix");var Base=require("runtime/base").Base,Channel=exports.Channel=Object.create(Base,{duration:{value:-1,writable:!0},_sampler:{value:null,writable:!0},sampler:{get:function(){return this._sampler},set:function(t){this._sampler=t}},_target:{value:null,writable:!0},target:{get:function(){return this._target},set:function(t){this._target=t}},_path:{value:null,writable:!0},path:{get:function(){return this._path},set:function(t){this._path=t}},parameterDelegate:{value:{handleError:function(t,e){console.log("ERROR:parameterDelegate:"+t+" :"+e)},convert:function(t,e){return new Float32Array(t)},resourceAvailable:function(t,e){}}},getParameterArray:{value:function(t,e){return e.getResource(t,this.parameterDelegate,null)}},updateTargetsAtTime:{value:function(t,e){var i=this.sampler.input,a=this.sampler.output,s=this.getParameterArray(i,e),n=this.getParameterArray(a,e);if(s&&n){t/=1e3;var r=i.count;this.duration=s[r-1],t%=this.duration;var u,c=0,l=0,h=0;if(r>0){for(u=c;u<r-1;u++)s[u]<=t&&t<s[u+1]&&(c=u,s[u+1]!=s[u]&&(h=s[u+1]-s[u],l=(t-s[u])/h));null==this.__vec4&&(this.__vec4=vec4.create()),null==this.__vec3&&(this.__vec3=vec3.create()),null==this.__vec2&&(this.__vec2=vec2.create());var o=null;switch(a.componentsPerAttribute){case 4:o=this.__vec4;break;case 3:o=this.__vec3;break;case 2:o=this.__vec2;break;case 1:console.log("float interpolation not handled yet")}this.index=c;var v=c*a.componentsPerAttribute,_=v+a.componentsPerAttribute;if("rotation"==this.path){var p=0,m=1,f=2,g=f;if(g==p){var b=vec4.createFrom(n[v+0],n[v+1],n[v+2],n[v+3]),d=vec4.createFrom(n[_+0],n[_+1],n[_+2],n[_+3]);vec3.normalize(b),vec3.normalize(d);var A=vec3.create();vec3.cross(b,d,A);var q=(Math.sqrt(vec3.dot(b,b)),Math.sqrt(vec3.dot(d,d)),Math.acos(vec3.dot(b,d))),w=mat4.identity();mat4.rotate(w,q*l,A),mat4.multiplyVec3(w,b,A),vec3.normalize(A);var x=b[3]+(d[3]-b[3])*l;quat4.fromAngleAxis(x,A,o)}else if(g==m){var b=vec4.createFrom(n[v+0],n[v+1],n[v+2],n[v+3]),d=vec4.createFrom(n[_+0],n[_+1],n[_+2],n[_+3]);for(u=0;u<o.length;u++){var y=b[u],B=d[u];d[u]=y+(B-y)*l}quat4.fromAngleAxis(d[3],d,o)}else if(g==f){null==this._quats&&(this._quats=[],this._quats.push(quat4.create()),this._quats.push(quat4.create())),null==this._vecs&&(this._vecs=[],this._vecs.push(vec3.create()),this._vecs.push(vec3.create())),this._vecs[0][0]=n[v+0],this._vecs[0][1]=n[v+1],this._vecs[0][2]=n[v+2],this._vecs[1][0]=n[_+0],this._vecs[1][1]=n[_+1],this._vecs[1][2]=n[_+2];var D=this._quats[0],O=this._quats[1];quat4.fromAngleAxis(n[v+3],this._vecs[0],D),quat4.fromAngleAxis(n[_+3],this._vecs[1],O),quat4.slerp(D,O,l,o)}}else for(u=0;u<o.length;u++){var y=n[v+u],B=n[_+u];o[u]=y+(B-y)*l}this.target.transform[this.path]=o}}}},initWithDescription:{value:function(t){return this.init(),this.index=0,this.target=t.target,this}},init:{value:function(){return this.__Base_init(),this}}}),Sampler=Object.create(Base,{_input:{value:null,writable:!0},input:{get:function(){return this._input},set:function(t){this._input=t}},_output:{value:null,writable:!0},output:{get:function(){return this._output},set:function(t){this._output=t}},initWithDescription:{value:function(t){return this.init(),this}},init:{value:function(){return this.__Base_init(),this}}});exports.Animation=Object.create(Base,{_count:{value:0,writable:!0},_parameters:{value:null,writable:!0},_channels:{value:null,writable:!0},_samplers:{value:null,writable:!0},_duration:{value:0,writable:!0},channels:{get:function(){return this._channels},set:function(t){this._channels=t}},samplers:{get:function(){return this._samplers},set:function(t){this._samplers=t}},parameters:{get:function(){return this._parameters},set:function(t){this._parameters=t}},count:{get:function(){return this._count},set:function(t){this._count=t}},duration:{get:function(){if(this.channels&&this.channels.length)return this.channels[0].duration}},updateTargetsAtTime:{value:function(t,e){this.channels.forEach(function(i){i.updateTargetsAtTime(t,e)},this)}},initWithDescription:{value:function(t){this.init(),this.count=t.count;return Object.keys(t.samplers).forEach(function(e){var i=t.samplers[e],a=Object.create(Sampler).initWithDescription(i);this.samplers[e]=a},this),t.channels.forEach(function(t){var e=Object.create(Channel).initWithDescription(t);e.sampler=this.samplers[t.sampler],e.target=t.target,this.channels.push(e)},this),this}},init:{value:function(){return this.__Base_init(),this.channels=[],this.samplers={},this}}});