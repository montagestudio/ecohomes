var Montage=require("montage").Montage,Component3D=require("runtime/component-3d").Component3D,RuntimeTFLoader=require("runtime/runtime-tf-loader").RuntimeTFLoader,URL=require("url"),SceneResourceLoader=require("runtime/scene-resource-loader").SceneResourceLoader,Q=require("q");exports.Scene=Component3D.specialize({constructor:{value:function(){this["super"]()}},_resourcesLoaded:{value:!1,writable:!0},sceneResourcesDidPrepare:{value:function(){this._resourcesLoaded||(this._prepareToRenderDefer&&this._prepareToRenderDefer.resolve(),this._resourcesLoaded=!0,this.dispatchEventNamed("resourcesDidLoad",!0,!1,this),this.status="loaded",console.log("resourcesDidLoad"))}},isLoaded:{value:function(){return"loaded"==this.status}},status:{value:0,writable:!0},path:{set:function(e){if(e){if(e.indexOf(".json")===-1)return;var r=URL.parse(e);if(!r.scheme){var t=Object.keys(require.packages);e=URL.resolve(t[0],e)}}if(e!==this._path){var i={};if(i.loadCompleted=function(e){this.totalBufferSize=n.totalBufferSize,this.glTFElement=e,this.status="loaded",console.log("scene loaded:"+this._path)}.bind(this),e){var n=Object.create(RuntimeTFLoader);this.status="loading",n.initWithPath(e),n.delegate=i,n.load(null,null)}else this.scene=null;this._path=e}},get:function(){return this._path}},_prepareToRenderDefer:{value:null,writable:!0},prepareToRender:{value:function(e){if(null==this._prepareToRenderDefer){this._prepareToRenderDefer=Q.defer();var r=Object.create(SceneResourceLoader).init(this.glTFElement,e,this);r.loadScene()}return this._prepareToRenderDefer.promise}},init:{value:function(){return this.initWithScene(this)}}});