montageDefine("c50fb48","runtime/animation",{dependencies:["runtime/dependencies/gl-matrix","runtime/base"],factory:function(t,e,i){t("runtime/dependencies/gl-matrix");var n=t("runtime/base").Base,a=e.Channel=Object.create(n,{duration:{value:-1,writable:!0},_sampler:{value:null,writable:!0},sampler:{get:function(){return this._sampler},set:function(t){this._sampler=t}},_target:{value:null,writable:!0},target:{get:function(){return this._target},set:function(t){this._target=t}},_path:{value:null,writable:!0},path:{get:function(){return this._path},set:function(t){this._path=t}},parameterDelegate:{value:{handleError:function(t,e){console.log("ERROR:parameterDelegate:"+t+" :"+e)},convert:function(t,e){return new Float32Array(t)},resourceAvailable:function(t,e){}}},getParameterArray:{value:function(t,e){return e.getResource(t,this.parameterDelegate,null)}},updateTargetsAtTime:{value:function(t,e){var i=this.sampler.input,n=this.sampler.output,a=this.getParameterArray(i,e),s=this.getParameterArray(n,e);if(a&&s){t/=1e3;var r=i.count;this.duration=a[r-1],t%=this.duration;var u,c=0,h=0,l=0;if(r>0){for(u=c;u<r-1;u++)a[u]<=t&&t<a[u+1]&&(c=u,a[u+1]!=a[u]&&(l=a[u+1]-a[u],h=(t-a[u])/l));null==this.__vec4&&(this.__vec4=vec4.create()),null==this.__vec3&&(this.__vec3=vec3.create()),null==this.__vec2&&(this.__vec2=vec2.create());var o=null;switch(n.componentsPerAttribute){case 4:o=this.__vec4;break;case 3:o=this.__vec3;break;case 2:o=this.__vec2;break;case 1:console.log("float interpolation not handled yet")}this.index=c;var v=c*n.componentsPerAttribute,_=v+n.componentsPerAttribute;if("rotation"==this.path){var p=0,m=1,f=2,g=f;if(g==p){var b=vec4.createFrom(s[v+0],s[v+1],s[v+2],s[v+3]),d=vec4.createFrom(s[_+0],s[_+1],s[_+2],s[_+3]);vec3.normalize(b),vec3.normalize(d);var A=vec3.create();vec3.cross(b,d,A);var q=(Math.sqrt(vec3.dot(b,b)),Math.sqrt(vec3.dot(d,d)),Math.acos(vec3.dot(b,d))),w=mat4.identity();mat4.rotate(w,q*h,A),mat4.multiplyVec3(w,b,A),vec3.normalize(A);var y=b[3]+(d[3]-b[3])*h;quat4.fromAngleAxis(y,A,o)}else if(g==m){var b=vec4.createFrom(s[v+0],s[v+1],s[v+2],s[v+3]),d=vec4.createFrom(s[_+0],s[_+1],s[_+2],s[_+3]);for(u=0;u<o.length;u++){var D=b[u],x=d[u];d[u]=D+(x-D)*h}quat4.fromAngleAxis(d[3],d,o)}else if(g==f){null==this._quats&&(this._quats=[],this._quats.push(quat4.create()),this._quats.push(quat4.create())),null==this._vecs&&(this._vecs=[],this._vecs.push(vec3.create()),this._vecs.push(vec3.create())),this._vecs[0][0]=s[v+0],this._vecs[0][1]=s[v+1],this._vecs[0][2]=s[v+2],this._vecs[1][0]=s[_+0],this._vecs[1][1]=s[_+1],this._vecs[1][2]=s[_+2];var O=this._quats[0],j=this._quats[1];quat4.fromAngleAxis(s[v+3],this._vecs[0],O),quat4.fromAngleAxis(s[_+3],this._vecs[1],j),quat4.slerp(O,j,h,o)}}else for(u=0;u<o.length;u++){var D=s[v+u],x=s[_+u];o[u]=D+(x-D)*h}this.target.transform[this.path]=o}}}},initWithDescription:{value:function(t){return this.init(),this.index=0,this.target=t.target,this}},init:{value:function(){return this.__Base_init(),this}}}),s=Object.create(n,{_input:{value:null,writable:!0},input:{get:function(){return this._input},set:function(t){this._input=t}},_output:{value:null,writable:!0},output:{get:function(){return this._output},set:function(t){this._output=t}},initWithDescription:{value:function(t){return this.init(),this}},init:{value:function(){return this.__Base_init(),this}}});e.Animation=Object.create(n,{_count:{value:0,writable:!0},_parameters:{value:null,writable:!0},_channels:{value:null,writable:!0},_samplers:{value:null,writable:!0},_duration:{value:0,writable:!0},channels:{get:function(){return this._channels},set:function(t){this._channels=t}},samplers:{get:function(){return this._samplers},set:function(t){this._samplers=t}},parameters:{get:function(){return this._parameters},set:function(t){this._parameters=t}},count:{get:function(){return this._count},set:function(t){this._count=t}},duration:{get:function(){if(this.channels&&this.channels.length)return this.channels[0].duration}},updateTargetsAtTime:{value:function(t,e){this.channels.forEach(function(i){i.updateTargetsAtTime(t,e)},this)}},initWithDescription:{value:function(t){this.init(),this.count=t.count;return Object.keys(t.samplers).forEach(function(e){var i=t.samplers[e],n=Object.create(s).initWithDescription(i);this.samplers[e]=n},this),t.channels.forEach(function(t){var e=Object.create(a).initWithDescription(t);e.sampler=this.samplers[t.sampler],e.target=t.target,this.channels.push(e)},this),this}},init:{value:function(){return this.__Base_init(),this.channels=[],this.samplers={},this}}})}});