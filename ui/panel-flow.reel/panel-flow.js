var Component=require("montage/ui/component").Component,KeyComposer=require("montage/composer/key-composer").KeyComposer;exports.PanelFlow=Component.specialize({constructor:{value:function(){this["super"](),this.defineBinding("flow.content",{"<-":"content"}),this.defineBinding("content.defined() ? null : flow.contentController",{"<-":"contentController"})}},handleKeydown:{value:function(t){var e=t.keyCode||t.which;38===e?(this.scrollToPanel(Math.floor(this.flow.scroll-1)),t.preventDefault()):40===e&&(this.scrollToPanel(Math.ceil(this.flow.scroll+1)),t.preventDefault())}},enterDocument:{value:function(t){t&&(document.addEventListener("keydown",this,!1),this._originalFlowPaths=this.flow.paths)}},__height:{value:null},_height:{get:function(){return this.__height},set:function(t){this.__height=t}},__numberOfIterations:{value:null},_numberOfIterations:{get:function(){return this.__numberOfIterations},set:function(t){this.__numberOfIterations=t}},__rowHeight:{value:null},_rowHeight:{get:function(){return this.__rowHeight},set:function(t){this.__rowHeight=t}},__firstIteration:{value:null},_firstIteration:{get:function(){return this.__firstIteration},set:function(t){this.__firstIteration=t,this.needsDraw=!0}},willDraw:{value:function(){var t,e,n,i,o,s,r=[];if("undefined"!=typeof this.__firstIteration&&null!==this.__firstIteration){for(this._width=this.element.clientWidth,this._height=this.element.clientHeight,this._rowHeight=this.__firstIteration.firstElement.clientHeight+20,this.flow.linearScrollingVector=[0,-500*this.__rowHeight/this.__height],i=0;i<this._originalFlowPaths.length;i++){e=this._originalFlowPaths[i],r.push({});for(n in e)if(e.hasOwnProperty(n))if("knots"===n)for(r[i].knots=[],o=0;o<e[n].length;o++){r[i].knots.push(t={});for(s in e[n][o])if(e[n][o].hasOwnProperty(s))switch(s){case"knotPosition":case"nextHandlerPosition":case"previousHandlerPosition":t[s]=[e[n][o][s][0],e[n][o][s][1]*this.__rowHeight/300,e[n][o][s][2]];break;default:t[s]=e[n][o][s]}}else r[i][n]=e[n]}this.flow.paths=r,this.flow.cameraTargetPoint=[0,this.__rowHeight,0],this.flow.cameraPosition=[0,this.__rowHeight,this.__height/2],this.flow.cameraFov=90,this.flow.boundingBoxSize=[1,40*this.__rowHeight,0]}}},_hideNext:{value:!1},draw:{value:function(){this._hideNext&&this.nextPageElement.classList.add("hidden")}},content:{value:null},contentController:{value:null},_scroll:{value:null},scroll:{get:function(){return this._scroll},set:function(t){this._scroll=t,null===this.currentPanelIndex&&this.didTranslateEnd()}},_currentPanelIndex:{value:null},currentPanelIndex:{get:function(){return this._currentPanelIndex},set:function(t){this._currentPanelIndex=t}},didTranslateStart:{value:function(){this.dispatchEventNamed("flowTranslateStart",!0,!1),this._hideNext=!0,this.classList.add("scrolling"),this.needsDraw=!0}},didTranslateEnd:{value:function(){this._currentPanelIndex!==Math.round(this.scroll)&&(this.currentPanelIndex=Math.round(this.scroll)),this.classList.remove("scrolling"),this.needsDraw=!0}},scrollToPanel:{value:function(t){this.flow.startScrollingIndexToOffset(t,0)}}});